@@ Ptolemy
@@ A horoscope bot character that makes use of the OpenAI API.
@@ Requires the server script in "mush_gpt.py".

@@ author = Matt Westfall
@@ email = disloops@gmail.com
@@ source = https://github.com/disloops/mushcode/blob/master/ptolemy.txt

@@ Created and tested under PennMUSH v1.8.8

@create Ptolemy
@lock/basic Ptolemy==#1
@lock/enter Ptolemy==#1
@lock/page Ptolemy==#1
@set Ptolemy=MONITOR
@set Ptolemy=WIZARD
@parent Ptolemy=get_parent_person()

&FAILURE Ptolemy=There is no need - you can cultivate these powers yourself.
&EFAIL Ptolemy=Metaphysically?
&USE Ptolemy=Just speak your query aloud!

&DESCRIBE Ptolemy=Ptolemy is shrouded in mists.

&ON_SPEECH Ptolemy=^<*> * says, "*":th setq(Content-Type,application/json);th setq(0,%1 says\, "%2");th setq(1,json(object, auth, json(string, [get_mushgpt_pw()]), char, json(string, ptolemy), text, json(string, %q0)));@http/post %!/speak=[get_mushgpt_url()]/bot, %q1

&CMD_HELPER Ptolemy=[edit(%0,\\",",%%r,%r)]

&SPEAK Ptolemy=th setq(2,[trim(json_query(%0, get, message),")]);@break strmatch(%q2,Failed:*)={@chat astral=The stars have arrayed into a troubling sign.};@chat astral=[u(CMD_HELPER,%q2)]

